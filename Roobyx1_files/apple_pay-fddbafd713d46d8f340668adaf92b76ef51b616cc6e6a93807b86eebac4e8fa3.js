!function(){var t=function(t){var e={exports:{}};return t.call(e.exports,e,e.exports),e.exports},e=(window,function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()),n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o=function(t){return t&&t.__esModule?t:{"default":t}},a=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},s=t(function(t,e){"use strict";function n(t){var e={city:t.locality,province_code:t.administrativeArea,zip:t.postalCode};t.countryCode?e.country_code=t.countryCode.toLowerCase():t.country&&(e.country=t.country.toLowerCase()),t.givenName&&(e.first_name=t.givenName),t.familyName&&(e.last_name=t.familyName);var n=t.addressLines;return n&&n.length&&(e.address1=n[0],n[1]&&(e.address2=n[1])),s(e)}function r(t,e){return{type:"final",label:e,amount:t.total_price}}function i(t){var e=[{type:"final",label:"Subtotal",amount:t.subtotal_price}];return t.shipping_rate&&(e=e.concat([{type:"final",label:"Shipping",amount:t.shipping_rate.price}])),t.tax_lines&&t.tax_lines.length&&(e=e.concat(t.tax_lines.map(c))),e}function o(t){return a(t).map(l)}function a(t){return[].concat(t).sort(u)}function s(t){var e=t.country_code,n=t.country,r=t.zip,i={};return d.test(r)&&(("ca"===e||"canada"===n)&&(i.zip=r.trim()+" 0Z0"),"gb"===e&&(i.zip=r.trim()+" 0ZZ")),Object.assign({},t,i)}function u(t,e){var n=t.price,r=e.price;return n>r?-1:r>n?1:0}function l(t){return{identifier:t.id,label:t.title,detail:"",amount:t.price}}function c(t){return{label:t.title,amount:t.price}}Object.defineProperty(e,"__esModule",{value:!0}),e.addressFromEvent=n,e.totalFromCheckout=r,e.lineItemsFromCheckout=i,e.transformedShippingRates=o,e.sortShippingRates=a;var d=/^[a-z0-9]{2,4}\s?$/i}),u=t(function(t,r){"use strict";function i(){var t=new Uint8Array(32);return window.crypto.getRandomValues(t),t.map(function(t){return t.toString(16)}).join("")}function o(t){return t.response&&422===t.response.status?ApplePaySession.STATUS_INVALID_SHIPPING_CONTACT:ApplePaySession.STATUS_FAILURE}function a(t){return t.billing_address?ApplePaySession.STATUS_INVALID_BILLING_POSTAL_ADDRESS:t.shipping_address?ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS:ApplePaySession.STATUS_FAILURE}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function t(e){var r=e.apiClient,o=e.sessionToken,a=e.merchantName,s=e.session,u=e.strategy;if(n(this,t),this.apiClient=r,this.strategy=u,this._sessionToken=o||i(),this._merchantName=a,this._session=s,!u)throw new Error("`strategy` must be supplied to ShopifyApplePaySession");this._session.oncancel=this._trackCallback("cancelled",this._onCancel).bind(this),this._session.onshippingcontactselected=this._trackCallback("shipping contact selected",this._onShippingContactSelected).bind(this),this._session.onshippingmethodselected=this._trackCallback("shipping method selected",this._onShippingMethodSelected).bind(this),this._session.onpaymentauthorized=this._trackCallback("payment authorized",this._onPaymentAuthorized).bind(this),this._session.onpaymentmethodselected=this._trackCallback("payment method selected",this._onPaymentMethodSelected).bind(this),this._session.onvalidatemerchant=this._trackCallback("merchant validated",this._onValidateMerchant.bind(this))}return e(t,[{key:"begin",value:function(){this._session.begin()}},{key:"_onCancel",value:function(){return Promise.resolve()}},{key:"_onShippingContactSelected",value:function(t){var e=this,n={partial_addresses:!0,shipping_address:s.addressFromEvent(t.shippingContact)};return this._updateCheckout(n).then(this._fetchShippingRates.bind(this)).then(this._setDefaultShippingRate.bind(this)).then(function(t){return e._session.completeShippingContactSelection(ApplePaySession.STATUS_SUCCESS,s.transformedShippingRates(e.availableShippingRates),s.totalFromCheckout(t,e._merchantName),s.lineItemsFromCheckout(t))})["catch"](function(t){return e._session.completeShippingContactSelection(o(t))})}},{key:"_onShippingMethodSelected",value:function(t){var e=this,n=t.shippingMethod,r={shipping_rate:{id:n.identifier}};return this._updateCheckout(r).then(function(t){return e._session.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS,s.totalFromCheckout(t,e._merchantName),s.lineItemsFromCheckout(t))})["catch"](function(){return e._session.completeShippingMethodSelection(ApplePaySession.STATUS_FAILURE)})}},{key:"_onPaymentAuthorized",value:function(t){var e=t.payment,n=e.token.paymentData,r={email:e.billingContact.emailAddress||e.shippingContact.emailAddress,billing_address:s.addressFromEvent(e.billingContact),shipping_address:s.addressFromEvent(e.shippingContact)};if(!this.checkout.shipping_rate)return this._session.completePayment(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS);var o={unique_token:i(),amount:this.checkout.total_price,payment_token:{type:"apple_pay",payment_data:JSON.stringify(n)}};return this._updateCheckout(r).then(this._submitPayment.bind(this,o)).then(this._getCheckout.bind(this)).then(this._completePayment.bind(this))["catch"](this._handlePaymentError.bind(this))}},{key:"_onPaymentMethodSelected",value:function(){return this._session.completePaymentMethodSelection(s.totalFromCheckout(this.checkout,this._merchantName),s.lineItemsFromCheckout(this.checkout)),Promise.resolve()}},{key:"_onValidateMerchant",value:function(t){var e=this,n=t.validationURL,r={domain:window.location.hostname,id:this._sessionToken,validation_url:n};return this.strategy.build().then(function(t){return e.checkout=t}).then(function(){return e.apiClient.post("/apple_pay/sessions",r)}).then(function(t){var n=t.body;return e._session.completeMerchantValidation(n)})["catch"](function(){return e._session.abort()})}},{key:"_fetchShippingRates",value:function(){var t=this;return this.apiClient.get("/api/checkouts/"+this.checkout.token+"/shipping_rates").then(function(e){var n=e.shipping_rates;return t.availableShippingRates=s.sortShippingRates(n)})}},{key:"_setDefaultShippingRate",value:function(){var t=this.checkout.shipping_rate;if(t)return this.checkout;var e=this.availableShippingRates||[],n=e[0];return n?this._updateCheckout({shipping_rate:{id:n.id}}):this.checkout}},{key:"_getCheckout",value:function(){var t=this;return this.apiClient.get("/api/checkouts/"+this.checkout.token).then(function(e){return t.checkout=e.checkout})}},{key:"_updateCheckout",value:function(t){var e=this;return this.apiClient.patch("/api/checkouts/"+this.checkout.token,{checkout:t}).then(function(t){return e.checkout=t.checkout})}},{key:"_submitPayment",value:function(t){return this.apiClient.post("/api/checkouts/"+this.checkout.token+"/payments",{payment:t})}},{key:"_completePayment",value:function(){this._session.completePayment(ApplePaySession.STATUS_SUCCESS),window.location=this.checkout.order_status_url}},{key:"_handlePaymentError",value:function(t){var e=this;t&&t.response&&422===t.response.status?t.response.json().then(function(t){return a(t.errors)}).then(function(t){return e._session.completePayment(t)})["catch"](function(){return e._session.completePayment(ApplePaySession.STATUS_FAILURE)}):this._session.completePayment(ApplePaySession.STATUS_FAILURE)}},{key:"_trackCallback",value:function(t,e){var n=this;return function(r){console.log(t,r,n._session),e.call(n,r).then(function(){return n._track(t)})["catch"](function(t){throw t})}}},{key:"_track",value:function(t){window.ShopifyAnalytics&&ShopifyAnalytics.lib&&ShopifyAnalytics.lib.track&&ShopifyAnalytics.lib.track("Apple Pay slate - "+t,{checkoutToken:this.checkout.token})}}]),t}();r["default"]=u}),l=t(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.response=t,r.stack=(new Error).stack,r.name=r.constructor.name,r}return r(e,t),e}(Error);e["default"]=o}),c=t(function(t,r){"use strict";function i(t){return t?JSON.parse(t):null}function o(t,e){var n=Object.assign({method:"GET"},e);return new Promise(function(e,r){var i=new XMLHttpRequest;i.open(n.method,t,!0),Object.keys(n.headers).forEach(function(t){i.setRequestHeader(t,n.headers[t])}),i.onload=function(){var t="response"in i?i.response:i.responseText;e(new s(t,i.status,i.getAllResponseHeaders()))},i.onerror=i.ontimeout=r,i.send(n.body)})}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o;var a=function(){function t(){var e=this,r=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n(this,t),this._headers={};var i=r.trim().split("\n");i.forEach(function(t){var n=t.trim().split(":"),r=n.shift().trim(),i=n.join(":").trim();e._headers[r]=i})}return e(t,[{key:"get",value:function(t){return this._headers[t]}}]),t}(),s=function(){function t(e,r,i){n(this,t),this.body=e,this.status=r,this.headers=new a(i),this.ok=r>=200&&300>r}return e(t,[{key:"text",value:function(){return Promise.resolve(this.body)}},{key:"json",value:function(){return this.text().then(i)}}]),t}()}),d=t(function(t,r){"use strict";function i(t){return 204===t.status||202===t.status?t:t.ok?t.json():Promise.reject(new s["default"](t))}function a(t){return btoa(t+":")}Object.defineProperty(r,"__esModule",{value:!0});var s=o(l),u=o(c),d=function(){function t(e){var r=e.accessToken,i=e.host;n(this,t),this.host=i,this.headers={"Content-Type":"application/json",Accept:"application/json",Authorization:"Basic "+a(r),"X-Shopify-Checkout-Version":"2016-09-06"},this.pollIfRequired=this.pollIfRequired.bind(this)}return e(t,[{key:"get",value:function(t){return this.request("GET",t)}},{key:"post",value:function(t,e){return this.request("POST",t,e)}},{key:"patch",value:function(t,e){return this.request("PATCH",t,e)}},{key:"put",value:function(t,e){return this.request("PUT",t,e)}},{key:"pollIfRequired",value:function(t){return 202===t.status?this.poll(t.headers.get("Location")):Promise.resolve(t)}},{key:"poll",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?2e4:arguments[1],r=arguments.length<=2||void 0===arguments[2]?250:arguments[2],i={method:"GET",headers:this.headers},o=Number(new Date)+n;return new Promise(function(n,a){(function s(){var e=this;u["default"](t,i).then(function(t){switch(t.status){case 200:return n(t);case 202:return setTimeout(s.bind(e),r);default:return a(new Error("ApplePay polling failed"))}})["catch"](function(){return Number(new Date)<o?setTimeout(s,r):a(new Error("ApplePay polling timed out"))})}).call(e)})}},{key:"request",value:function(t,e,n){var r={method:t,headers:this.headers,body:n?JSON.stringify(n):null};return"/"===e[0]&&this.host&&(e="https://"+this.host+e),u["default"](e,r).then(this.pollIfRequired).then(i)}}]),t}();r["default"]=d}),h=t(function(t,e){"use strict";function n(t){var e=t.buttons,n=t.apiHost,i=a(t,["buttons","apiHost"]);if(window.ApplePaySession&&ApplePaySession.canMakePayments()&&e&&e.length){var o=document.querySelector("meta[name=shopify-checkout-api-token]"),u=document.getElementById("apple-pay-shop-capabilities");if(o&&u){var l=o.getAttribute("content"),d=JSON.parse(u.textContent),h=new c["default"]({accessToken:l,host:n});i.merchantName=d.shopName,i.apiClient=h,i.strategy.setApiClient(h);for(var p=0;p<e.length;++p){var f=e[p];f.style.display=f.getAttribute("data-display-value")||"inline-block",f.addEventListener("click",r.bind(null,d,i))}s("shown")}}}function r(t,e,n){n.preventDefault(),s("clicked"),e.session=new ApplePaySession(h,i(t)),new l["default"](e).begin()}function i(t){var e=t.shopName,n=a(t,["shopName"]);return n.total={type:"pending",label:e,amount:"1.00"},n}function s(t){window.ShopifyAnalytics&&ShopifyAnalytics.lib&&ShopifyAnalytics.lib.track&&ShopifyAnalytics.lib.track("Apple Pay button - "+t)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n;var l=o(u),c=o(d),h=1}),p=t(function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.apiClient;n(this,t),this.setApiClient(r)}return e(t,[{key:"setApiClient",value:function(t){this.apiClient=t}},{key:"getCart",value:function(){return this.apiClient.get("/cart")}},{key:"getCheckout",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.checkout.token:arguments[0];return this.apiClient.get("/api/checkouts/"+t).then(function(t){var e=t.checkout;return e})}},{key:"createCheckout",value:function(t){return this.apiClient.post("/api/checkouts",{checkout:t}).then(function(t){var e=t.checkout;return e})}}]),t}();r["default"]=i}),f=t(function(t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=o(p),u=function(t){function o(){return n(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,t),e(o,[{key:"build",value:function(){return this.createCheckout(this.serialize())}},{key:"serialize",value:function(){var t=document.querySelector('form[action^="/cart/add"]');return{line_items:[{variant_id:t.elements.id.value,quantity:t.elements.quantity.value}]}}}]),o}(s["default"]);a["default"]=u}),m=t(function(t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=o(p),u=function(t){function o(){return n(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,t),e(o,[{key:"build",value:function(){var t=this;return this.getCart().then(function(e){var n=e.token;return t.createCheckout({cart_token:n})})}}]),o}(s["default"]);a["default"]=u});t(function(t,e){"use strict";var n=o(h),r=o(f),i=o(m);document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){n["default"]({buttons:document.querySelectorAll('.shopify-apple-pay-button[data-strategy="product"]'),strategy:new r["default"]}),n["default"]({buttons:document.querySelectorAll('.shopify-apple-pay-button[data-strategy="cart"]'),strategy:new i["default"]})})})}();